<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>{{ $.Site.Title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {{ hugo.Generator }}
    <link rel="icon" href="{{ .Site.Params.favicon | absURL }}" type="image/x-icon">
    {{ $style := resources.Get "presidium.scss" | resources.ToCSS | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $style.Permalink }}">
    {{ if resources.Get "index.scss" }}
    {{ with resources.Get "index.scss" | resources.ToCSS | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ .Permalink }}">
    {{ end }}
    {{ end }}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

</head>

<body>
    {{ if $.Site.Params.enterprise_enabled }}
    <div data-key="{{ $.Site.Params.enterprise_key }}" data-title="{{ $.Site.Title }}" id="presidium-enterprise"
        class="presidium-enterprise">
    </div>
    {{ end }}

    <div id="presidium-navigation">
        {{ partial "navigation.html" .}}
    </div>
    <div id="presidium-container" class="container-fluid">
        <div class="row">
            <div id="presidium-content" class="col-lg-10 col-md-12">
                <h1 class="page-title">{{ .Title }}</h1>
                <hr />

                <section>
                    {{ partial "info.html" }}
                    {{ block "content" . }}
                    {{ end }}
                </section>
                {{ partial "footer.html" . }}
            </div>
            <div class="col-lg-2"></div>
        </div>
    </div>
    <!--presidium-container-->

    {{ partial "modal.html" }}

    <script>
        $(document).ready(function () {
            $('.menu-expander').click(function (event) {
                event.preventDefault();
                if (this.firstElementChild) {
                    this.firstElementChild.classList.toggle('glyphicon-chevron-down');
                    this.firstElementChild.classList.toggle('glyphicon-chevron-right');
                }
                $(this).parent().closest('.menu-row').toggleClass('open').toggleClass('closed');
            });

            $('.toggle').click(function (event) {
                event.preventDefault();
                $('.navbar-items').toggle('expanded');
            });

            // Set scrollspy offset
            let offset = 0;
            const content = $('.article-title').get(0);
            if (content) {
                offset = window.pageYOffset + content.getBoundingClientRect().top;
                $('body').scrollspy({ target: '#presidium-navigation', offset: offset });
            }
            let bar_offset = 0;
            const enterprise_bar = $('#presidium-enterprise-toolbar').get(0);
            if (enterprise_bar) {
                bar_offset = enterprise_bar.getBoundingClientRect().height;
            }

            $(window).scroll(function() {
                if ($(document).scrollTop() >= offset) {
                    $('body').data()['bs.scrollspy'].options.offset = (30 + bar_offset);
                }
                else {
                    $('body').data()['bs.scrollspy'].options.offset = offset;
                }
                $('body').data()['bs.scrollspy'].process();
                $('body').scrollspy("refresh");
            });


            // filter articles and navigation when role changes
            const filterArticles = (selectedRole) => {
                sessionStorage.setItem('role', selectedRole);
                $('.article').show()
                $('#presidium-navigation .menu-row').removeClass('hidden').show()
                if (selectedRole != 'All Roles') {
                    const $articles = $(`.article:not([data-roles="All Roles"],[data-roles="${selectedRole}"])`)
                    $articles.each((i, article) => {
                        $(article).hide();
                        $(`#presidium-navigation .menu-row>a[data-target="#${article.id}"]`)
                            .parent()
                            .addClass('hidden')
                            .hide();
                    });
    
                    $('#presidium-navigation .menu-row').each((_, e) => {
                        const $row = $(e)
                        const $children = $row.find('ul>li.menu-row');
                        const $active = $children.filter(':not(.hidden)');
                        if ($active.length == 0 && $children.length > 0) {
                            $row.hide();
                        }
                    });
                }
            };
    
            const lastRole = sessionStorage.getItem('role');
            if (lastRole) {
                $('#roles-select').val(lastRole);
                filterArticles(lastRole);
            }
    
            $('#roles-select').on('change', function (e) {
                const optionSelected = $("option:selected", this);
                const selectedRole = this.value;
                filterArticles(selectedRole);
            });
        });
    </script>

    <!-- Components -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="/presidium.js"></script>
    <script>
        window.tooltips.mount();
        window.articles.mount();
        window.modal.mount();

        mermaid.initialize({ startOnLoad: true });
    </script>

    {{ if $.Site.Params.enterprise_enabled }}
    <script src="{{ $.Site.Params.enterprise_script }}"></script>
    {{ end }}

</body>

</html>
