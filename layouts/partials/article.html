{{ $roles := .Params.roles | default "All Roles" }}
{{/* Use title if no slug */}}
{{ $slug := humanize .Params.Title }} {{/* Handles any dashes in the title */}}
{{ $slug = anchorize $slug }}
{{ $slug = replaceRE `(-{2,})` "-" $slug }} {{/* Replaces multiple dashes with one */}}
{{ if .Params.Slug }}
    {{ $slug = .Params.Slug}}
{{ end }}

{{ $articleLink := (printf "%v#%v" .Parent.Page.RelPermalink $slug ) }}

{{ $type := "parent" }}
{{if not .Data.Pages }}
    {{ $type = "child" }}
{{end}}

{{ $nestedArticles := .Site.Params.includeNestedArticles | default true }}

{{ $content := 0 }}
{{ if .Content }}
    {{ $content = len .Content }}
{{ end }}

{{/* Unique id for this article */}}
{{ $articleId := .Params.id | default .File.Path }}

{{/* Unique id for file, used by scroll-spy and menu toggle  */}}
{{ $uid := .File.UniqueID }}

<div class="article {{ $type }}" data-roles="{{ $roles }}" id="{{ $uid }}" data-link="{{ $articleLink }}" permalink="{{.Page.RelPermalink}}">
    {{ if or (ne ($content) 0) $nestedArticles }}
    <div class="presidium-article-wrapper">
        <span class="anchor"  id="{{ $slug }}" data-id="{{ $articleId }}"></span>
        {{ if (eq .Parent.Title .Title) }}
            {{/*  No title - For when the main title is the same as the first article  */}}
        {{ else }}
            <div class="article-title" >
                {{ if .Data.Pages }}
                    <h1> {{ .Title }} {{ partial "edit-link.html" }}</h1>
                {{ else }}
                    <h2> {{ .Title }} {{ partial "edit-link.html" }}</h2>
                {{ end }}
                
                <div class="permalink">
                    <a style="cursor:pointer;" onclick="copyPermalink( {{ $articleLink }} )" id="{{.Page.RelPermalink}}" data-slug="#{{ $slug }}" class="link-icon" title="Permalink to this article"></a>
                </div>
            </div>
        {{ end }}

        {{ partial "article-header" . }}

        <article>{{ .Content }}</article>

        {{ if $nestedArticles }}
            {{/* Sort by filename if specified in config */}}
            {{ if .Site.Params.sortByFilePath }}
                {{/* Sort by file prefix */}}
                {{ range sort .Data.Pages "File.Path" }}
                    {{ partial "article" . }}
                {{ end }}
            {{ else }}
                {{/* Sort by weight otherwise the hugo default */}}
                {{ range .Data.Pages.ByWeight }}
                    {{ partial "article" . }}
                {{ end }}
            {{ end }}
        {{ end }}

        {{ if not .Data.Pages }}
            <hr>
        {{ end }}
    </div>
    {{ end }}
</div>
