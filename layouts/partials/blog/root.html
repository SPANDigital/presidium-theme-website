{{ $slug := (partial "common/slug" .) }}

{{ $nestedArticles := .Site.Params.includeNestedArticles | default true }}

{{ $articleLink := (printf "%v#%v" .Parent.Page.RelPermalink $slug ) }}
{{ $.Scratch.Set "articleLink" $articleLink }}

{{/*  Type of article  */}}
{{ $type := cond (not .Data.Pages) "child" "parent" }}

{{/* Unique id for this article */}}
{{ $file := .File }}
{{ if $file}}
{{ $articleId := .Params.id | default $file.Path }}
{{ $noContent := (eq (len .Content) 0) }}

{{/* Unique id for file, used by scroll-spy and menu toggle  */}}
{{ $uid := $file.UniqueID }}

<div class="blog {{ $type }}" id="{{ $uid }}" data-link="{{ $articleLink }}" permalink="{{.Page.RelPermalink}}" data-no-content="{{ $noContent }}" title="{{ .Title }}">
    {{ if or (ne (len .Content) 0) (and $nestedArticles (partial "common/pages" .)) }}
        <div class="presidium-article-wrapper">
            <span class="anchor"  id="{{ $slug }}" data-id="{{ $articleId }}"></span>
            
            {{ partial "article/validation" . }}
            {{ partial "blog/header" . }}
            {{ partial "blog/title" . }}
            {{ partial "blog/frontmatter" . }}
            {{ partial "article/content" . }}
            {{ partial "blog/footer" . }}
        </div>
    </div>

    {{ if $nestedArticles }}
        {{/* Sort by filename if specified in config */}}
        {{ if .Site.Params.sortByFilePath }}
            {{/* Sort by file prefix */}}
            {{ range sort .Data.Pages "File.Path" }}
                {{ partial "blog/root" . }}
            {{ end }}
        {{ else }}
            {{/* Sort by weight otherwise the hugo default */}}
            {{ range .Data.Pages.ByWeight }}
                {{ partial "blog/root" . }}
            {{ end }}
        {{ end }}
    {{ end }}
{{ else }}
</div>
{{ end }}
{{ end }}
