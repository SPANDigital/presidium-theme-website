{{/*  Returns the pages after filtering out the archived articles  */}}
{{ $pages := .Pages }}
{{ if and $.Site.Params.archive (ne $.Site.Params.archive.age 0)}}
    {{ $age := mul 86400 $.Site.Params.archive.age }}
    {{ $before := sub now.Unix $age }}
    {{ $pages = (where .RegularPages "Date.Unix" "gt" $before)}}

    {{/* expose a limited number of exposed archive items if there are too few active articles */}}
    {{ if (ne ($.Site.Params.archive.expose | default 0) 0)}}
        {{ $expose := $.Site.Params.archive.expose }}
        {{ $showItems := not (ge (len $pages) $expose) }}
        {{ $pages = cond $showItems (first $expose .RegularPages.ByDate.Reverse) $pages }}
    {{end}}
    {{ $pages = $pages | append .Sections }}
{{ end }}
{{ return $pages }}
