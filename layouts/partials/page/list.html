{{ partial "article/root" . }}
{{ $pages := (partial "common/pages" .) }}
{{ $siteScopes := .Site.Params.scopes }}
{{ $siteScopesEnabled := .Site.Params.scopesEnabled }}

{{/* Sort by filename if specified in config */}}
{{ if .Site.Params.sortByFilePath }}
    {{/* Sort by file prefix */}}
    {{ range sort $pages "File.Path" }}
        {{ $isRendering := true }}

        {{ if $siteScopesEnabled }}
            {{ if isset .Params "scope" }}
                {{ $pageScopes := .Params.scope }}
                {{ $isRendering = gt (len (intersect $pageScopes $siteScopes)) 0 }}    
            {{ end }}
        {{ end }}

        {{ if $isRendering }}
            {{ partial "article/root" . }}
        {{ end }}
    {{ end }}
{{ else }}
    {{/* Sort by weight otherwise the hugo default */}}
    {{ range $pages.ByWeight }}
        {{ $isRendering := true }}

        {{ if $siteScopesEnabled }}
            {{ if isset .Params "scope" }}
                {{ $pageScopes := .Params.scope }}
                {{ $isRendering = gt (len (intersect $pageScopes $siteScopes)) 0 }}    
            {{ end }}
        {{ end }}

        {{ if $isRendering }}
            {{ partial "article/root" . }}
        {{ end }}
    {{ end }}
{{ end }}