{{ $title := .Get 0}}
{{ $ref := .Get 1}}
{{ $page := "" }}

{{ if $ref }}
    {{ $page = .Site.GetPage $ref }}
{{ end }}


{{ if not $page }}
    {{ range where .Site.Pages "Section" "glossary" }}
        {{ if eq (lower .Title) (lower $title) }}
            {{ $page = . }}
        {{ end }}
    {{ end }}
{{ end }}

{{ if $page }}
    {{ $tooltipWord := print (path.Base $page.Permalink) }}
    {{ $old := printf "%s/" $tooltipWord }}
    {{ $new := printf "#%s" $tooltipWord }}
    <!-- Insert a '#' symbol before the glossary term so that it correctly navigates to link -->
    {{ $tooltipLink := replace $page.Permalink $old $new}}

    <a class="tooltips-term" href="{{ $tooltipLink }}" >
        {{ $title }}<span class="tooltips-text">{{ $page.Content | truncate 100 | plainify }}</span>
    </a>
{{ else }}
    {{ if $ref }}
        {{ errorf "Error rending tooltip at href [%s] in file [%s]" $ref .Page.File }}
    {{else}}
        {{ errorf "Error rending tooltip with title [%s] in file [%s]" $title .Page.File }}
    {{ end }}
{{ end }}
